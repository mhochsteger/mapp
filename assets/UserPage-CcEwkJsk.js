import{f as A,r as o,a as E,w as j,k as D,q as F,m as s,s as a,A as f,B as c,C as I,u as r,D as y,t as L,E as v,v as w,Q as C}from"./index-biZAYMy_.js";import{Q}from"./QForm-B6zZp2Tf.js";import{Q as U}from"./QItem-NaHNb7v-.js";import{Q as R}from"./QList-TemXHNzd.js";import{u as O}from"./use-quasar-ThZkhwN7.js";import{u as T}from"./user-I5XOLB1z.js";import{u as $}from"./auth-JCbPQ19o.js";import{a as P}from"./api-Drwuoc-q.js";import"./pinia-Cz-fGEgD.js";import"./websocket-DMgNuOHa.js";import"./utils-O6UG9Aye.js";import"./axios-Bf-I0BKU.js";import"./index-3fevySbJ.js";const se=A({__name:"UserPage",setup(z){const _=O(),t=T(),k=$(),g=o(null),N=o(null),V=o(""),n=o(""),b=o(""),d=o(t.email),m=o(t.firstName),i=o(t.lastName),S=o({}),q=E(async()=>g.value&&await g.value.validate());j(()=>k.isAuthenticated,()=>{d.value=t.email.value,m.value=t.firstName.value,i.value=t.lastName.value,S.value=t.apps.value});const p={name:[l=>!!l||"Required"],email:[l=>!!l||"E-mail is required",l=>/.+@.+\..+/.test(l)||"E-mail must be valid"],password:[l=>!!l||"Password is required",l=>l&&l.length>=6||"Password must be at least 6 characters"],matching:[l=>l===n.value||"Passwords not matching"]},B=async()=>{await P.post("/user/change_password",{password:V.value,new_password:n.value})&&(V.value="",n.value="",b.value="",N.value.reset(),_.notify({message:"Password changed",color:"positive"}))},x=async()=>{await g.value.validate();const l={};d.value!==t.email&&(l.email=d.value),m.value!==t.firstName&&(l.firstName=m.value),i.value!==t.lastName&&(l.lastName=i.value),Object.keys(l).length&&await P.post("/user/update",l)};return(l,e)=>(F(),D(y,{style:{"object-fit":"cover"}},{default:s(()=>[a(f,null,{default:s(()=>[c(" User Settings ("+I(r(t).name)+") ",1)]),_:1}),a(f,null,{default:s(()=>[a(R,null,{default:s(()=>[a(U,null,{default:s(()=>[a(y,{flat:""},{default:s(()=>[a(f,null,{default:s(()=>e[6]||(e[6]=[c(" Change User ")])),_:1}),a(f,null,{default:s(()=>[a(Q,{ref_key:"formUser",ref:g},{default:s(()=>[a(v,{modelValue:r(d),"onUpdate:modelValue":e[0]||(e[0]=u=>w(d)?d.value=u:null),rules:p.email,dense:"",label:"email"},null,8,["modelValue","rules"]),a(v,{modelValue:r(m),"onUpdate:modelValue":e[1]||(e[1]=u=>w(m)?m.value=u:null),rules:p.name,dense:"",label:"First name"},null,8,["modelValue","rules"]),a(v,{modelValue:r(i),"onUpdate:modelValue":e[2]||(e[2]=u=>w(i)?i.value=u:null),rules:p.name,dense:"",label:"Last name"},null,8,["modelValue","rules"]),e[8]||(e[8]=L("br",null,null,-1)),a(C,{color:"primary",disable:!r(q),onClick:x},{default:s(()=>e[7]||(e[7]=[c(" Confirm ")])),_:1},8,["disable"])]),_:1},512)]),_:1})]),_:1})]),_:1}),a(U,null,{default:s(()=>[a(y,{flat:""},{default:s(()=>[a(f,null,{default:s(()=>e[9]||(e[9]=[c(" Change Password ")])),_:1}),a(f,null,{default:s(()=>[a(Q,{ref_key:"formPassword",ref:N,onSubmit:B},{default:s(()=>[a(v,{modelValue:r(V),"onUpdate:modelValue":e[3]||(e[3]=u=>w(V)?V.value=u:null),label:"Current password",type:"password",dense:""},null,8,["modelValue"]),a(v,{modelValue:r(n),"onUpdate:modelValue":e[4]||(e[4]=u=>w(n)?n.value=u:null),label:"New password",type:"password",rules:p.password,color:"success",dense:""},null,8,["modelValue","rules"]),a(v,{modelValue:r(b),"onUpdate:modelValue":e[5]||(e[5]=u=>w(b)?b.value=u:null),label:"Confirm new password",type:"password",rules:p.password.concat(p.matching),color:"success",dense:""},null,8,["modelValue","rules"]),a(C,{color:"primary",type:"submit"},{default:s(()=>e[10]||(e[10]=[c(" Change password ")])),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{se as default};
