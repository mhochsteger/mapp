import{c as $e,o as Te,h as O,ac as Ne,ad as Ee,_ as Me,$ as Be,a0 as Re,ae as Ve,g as Fe,a1 as Pe,r as S,af as He,a3 as Je,a as A,w as G,ag as ze,N as fe,a7 as Ke,ah as Ge,b as Ye,G as pe,Z as Ze,f as B,y as U,q as p,I as P,s as t,Q as M,m as a,B as N,u,F as H,H as ge,C as $,k as j,x as Q,ai as be,v as he,D as W,A as q,t as y,L as Qe,j as We,a9 as Xe,E as oe,J as ve,aj as et,n as ye,ab as tt,M as at,a6 as lt}from"./index-biZAYMy_.js";import{Q as X}from"./QSpace-BBYIxtb5.js";import{Q as Ue,a as ne,b as nt,c as ot,d as we}from"./QTable--4kp4avH.js";import{Q as _e}from"./QItem-NaHNb7v-.js";import{Q as Y}from"./QItemSection-gXIjE-rJ.js";import{Q as ie}from"./QItemLabel-Dpd1RpBi.js";import{Q as Z,_ as R}from"./ButtonWithTooltip.vue_vue_type_script_setup_true_lang-DXByFzTW.js";import{a as V}from"./api-Drwuoc-q.js";import{J as it}from"./jsoneditor.min-DkeLFdXe.js";import{e as st,d as ut,i as ue,w as dt,b as rt}from"./utils-O6UG9Aye.js";import{d as ct}from"./pinia-Cz-fGEgD.js";import{_ as de}from"./DateComponent.vue_vue_type_script_setup_true_lang-CxvI1VgX.js";import{Q as mt}from"./QList-TemXHNzd.js";import{a as K,H as re,V as xe,T as ke,S as Ie,A as Se}from"./apps-CncVAk-B.js";import"./QChip-CiSapyxv.js";import"./format-CJebrXOQ.js";import"./selection-DysZVcNr.js";import"./axios-Bf-I0BKU.js";import"./index-3fevySbJ.js";import"./auth-JCbPQ19o.js";import"./i18n--eaCvEqZ.js";import"./marked.esm-CrmhQBcZ.js";import"./websocket-DMgNuOHa.js";const ft=$e({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(e,{slots:r,emit:n}){let d=!1,v,i,l=null,_=null,g,k;function T(){v&&v(),v=null,d=!1,l!==null&&(clearTimeout(l),l=null),_!==null&&(clearTimeout(_),_=null),i!==void 0&&i.removeEventListener("transitionend",g),g=null}function b(o,m,h){m!==void 0&&(o.style.height=`${m}px`),o.style.transition=`height ${e.duration}ms cubic-bezier(.25, .8, .50, 1)`,d=!0,v=h}function C(o,m){o.style.overflowY=null,o.style.height=null,o.style.transition=null,T(),m!==k&&n(m)}function L(o,m){let h=0;i=o,d===!0?(T(),h=o.offsetHeight===o.scrollHeight?0:void 0):(k="hide",o.style.overflowY="hidden"),b(o,h,m),l=setTimeout(()=>{l=null,o.style.height=`${o.scrollHeight}px`,g=D=>{_=null,(Object(D)!==D||D.target===o)&&C(o,"show")},o.addEventListener("transitionend",g),_=setTimeout(g,e.duration*1.1)},100)}function w(o,m){let h;i=o,d===!0?T():(k="show",o.style.overflowY="hidden",h=o.scrollHeight),b(o,h,m),l=setTimeout(()=>{l=null,o.style.height=0,g=D=>{_=null,(Object(D)!==D||D.target===o)&&C(o,"hide")},o.addEventListener("transitionend",g),_=setTimeout(g,e.duration*1.1)},100)}return Te(()=>{d===!0&&T()}),()=>O(Ne,{css:!1,appear:e.appear,onEnter:L,onLeave:w},r.default)}}),F=Ee({}),pt=Object.keys(Ve),ce=$e({name:"QExpansionItem",props:{...Ve,...Re,...Be,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:{},headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...Me,"click","afterShow","afterHide"],setup(e,{slots:r,emit:n}){const{proxy:{$q:d}}=Fe(),v=Pe(e,d),i=S(e.modelValue!==null?e.modelValue:e.defaultOpened),l=S(null),_=He(),{show:g,hide:k,toggle:T}=Je({showing:i});let b,C;const L=A(()=>`q-expansion-item q-item-type q-expansion-item--${i.value===!0?"expanded":"collapsed"} q-expansion-item--${e.popup===!0?"popup":"standard"}`),w=A(()=>e.contentInsetLevel===void 0?null:{["padding"+(d.lang.rtl===!0?"Right":"Left")]:e.contentInsetLevel*56+"px"}),o=A(()=>e.disable!==!0&&(e.href!==void 0||e.to!==void 0&&e.to!==null&&e.to!=="")),m=A(()=>{const f={};return pt.forEach(E=>{f[E]=e[E]}),f}),h=A(()=>o.value===!0||e.expandIconToggle!==!0),D=A(()=>e.expandedIcon!==void 0&&i.value===!0?e.expandedIcon:e.expandIcon||d.iconSet.expansionItem[e.denseToggle===!0?"denseIcon":"icon"]),J=A(()=>e.disable!==!0&&(o.value===!0||e.expandIconToggle===!0)),ee=A(()=>({expanded:i.value===!0,detailsId:_.value,toggle:T,show:g,hide:k})),te=A(()=>{const f=e.toggleAriaLabel!==void 0?e.toggleAriaLabel:d.lang.label[i.value===!0?"collapse":"expand"](e.label);return{role:"button","aria-expanded":i.value===!0?"true":"false","aria-controls":_.value,"aria-label":f}});G(()=>e.group,f=>{C!==void 0&&C(),f!==void 0&&z()});function se(f){o.value!==!0&&T(f),n("click",f)}function I(f){f.keyCode===13&&c(f,!0)}function c(f,E){E!==!0&&l.value!==null&&l.value.focus(),T(f),Ze(f)}function s(){n("afterShow")}function x(){n("afterHide")}function z(){b===void 0&&(b=ze()),i.value===!0&&(F[e.group]=b);const f=G(i,le=>{le===!0?F[e.group]=b:F[e.group]===b&&delete F[e.group]}),E=G(()=>F[e.group],(le,Ae)=>{Ae===b&&le!==void 0&&le!==b&&k()});C=()=>{f(),E(),F[e.group]===b&&delete F[e.group],C=void 0}}function ae(){const f={class:[`q-focusable relative-position cursor-pointer${e.denseToggle===!0&&e.switchToggleSide===!0?" items-end":""}`,e.expandIconClass],side:e.switchToggleSide!==!0,avatar:e.switchToggleSide},E=[O(pe,{class:"q-expansion-item__toggle-icon"+(e.expandedIcon===void 0&&i.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:D.value})];return J.value===!0&&(Object.assign(f,{tabindex:0,...te.value,onClick:c,onKeyup:I}),E.unshift(O("div",{ref:l,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),O(Y,f,()=>E)}function De(){let f;return r.header!==void 0?f=[].concat(r.header(ee.value)):(f=[O(Y,()=>[O(ie,{lines:e.labelLines},()=>e.label||""),e.caption?O(ie,{lines:e.captionLines,caption:!0},()=>e.caption):null])],e.icon&&f[e.switchToggleSide===!0?"push":"unshift"](O(Y,{side:e.switchToggleSide===!0,avatar:e.switchToggleSide!==!0},()=>O(pe,{name:e.icon})))),e.disable!==!0&&e.hideExpandIcon!==!0&&f[e.switchToggleSide===!0?"unshift":"push"](ae()),f}function Oe(){const f={ref:"item",style:e.headerStyle,class:e.headerClass,dark:v.value,disable:e.disable,dense:e.dense,insetLevel:e.headerInsetLevel};return h.value===!0&&(f.clickable=!0,f.onClick=se,Object.assign(f,o.value===!0?m.value:te.value)),O(_e,f,De)}function je(){return Ke(O("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:w.value,id:_.value},Ye(r.default)),[[Ge,i.value]])}function qe(){const f=[Oe(),O(ft,{duration:e.duration,onShow:s,onHide:x},je)];return e.expandSeparator===!0&&f.push(O(fe,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:v.value}),O(fe,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:v.value})),f}return e.group!==void 0&&z(),Te(()=>{C!==void 0&&C()}),()=>O("div",{class:L.value},[O("div",{class:"q-expansion-item__container relative-position"},qe())])}}),vt=B({__name:"CopyDownloadData",props:{data:{},filename:{},fileId:{}},setup(e){const r=e,n=()=>{const i=JSON.stringify(r.data);navigator.clipboard.writeText(i)};function d(i){const l=[];function _(g){if(g&&typeof g=="object"){g.hash&&l.push(g.hash);for(const k in g)g.hasOwnProperty(k)&&_(g[k])}}return _(i),l}const v=async()=>{const i=d(r.data.component.storage);ut(V.postBlob("zip_data_with_storage",{data:JSON.stringify(r.data),storage_hashes:i,filename:r.filename,file_id:r.fileId}))};return(i,l)=>(p(),U(P,null,[t(M,{color:"primary",flat:"",icon:"mdi-content-copy",onClick:n},{default:a(()=>[t(Z,null,{default:a(()=>l[1]||(l[1]=[N(" Copy data to clipboard")])),_:1})]),_:1}),t(M,{color:"primary",flat:"",icon:"mdi-download",onClick:l[0]||(l[0]=_=>u(st)({filename:`${i.filename}.json`,data:JSON.stringify(i.data),type:"application/json"}))},{default:a(()=>[t(Z,null,{default:a(()=>l[2]||(l[2]=[N(" Download data")])),_:1})]),_:1}),t(M,{color:"primary",flat:"",icon:"mdi-folder-download",onClick:v},{default:a(()=>[t(Z,null,{default:a(()=>l[3]||(l[3]=[N(" Download data with storage as zip")])),_:1})]),_:1})],64))}}),_t=ct("users",()=>{const e=S({});async function r(n){n in e.value||(e.value[n]="",e.value[n]=(await V.get(`app_admin/user/${n}/name`)).data)}return{names:e,load:r}}),Le=B({__name:"UserName",props:{id:{}},setup(e){const r=e,{id:n}=H(r),d=_t(),v=A(()=>d.names[n.value]);return ge(async()=>{v.value===void 0&&d.load(n.value)}),(i,l)=>(p(),U("span",null,$(u(v)),1))}}),Ce=B({__name:"DurationComponent",props:{time:{},start:{},end:{}},setup(e){const r=e,{time:n,start:d,end:v}=H(r),i=A(()=>{let l=n.value;if(["",null,void 0,NaN].includes(n.value)){if(["",null,void 0,NaN].includes(v.value))return"";l=v.value-d.value}if(l<1)return`${(1e3*l).toFixed(2)} ms`;if(l<60)return`${l.toFixed(2)} s`;const _=Math.floor(l/60),g=l%60;return`${_} m ${g.toFixed(2)} s`});return(l,_)=>$(u(i))}}),gt=B({__name:"MemoryAmount",props:{memory:{}},setup(e){const r=e,{memory:n}=H(r),d=A(()=>["",null,void 0,NaN].includes(n.value)?"":n.value<1e5?n.value+" K":n.value<1e5*1024?Math.ceil(n.value/1024)+" M":Math.ceil(n.value/1024/1024)+" G");return(v,i)=>(p(),U("span",null,$(u(d)),1))}}),bt={style:{"text-indent":"0px","white-space":"pre-wrap"}},me=B({__name:"LoadText",props:{tooltip:{default:""},title:{default:""},color:{default:void 0},url:{}},setup(e){const r=e,{url:n,tooltip:d,title:v,color:i}=H(r),l=S(!1),_=S("");return G(()=>l.value,async()=>{if(l.value===!1)return;const g=await V.get(n.value);_.value=g.data}),(g,k)=>(p(),U(P,null,[t(M,{flat:"",dense:"",icon:"mdi-console",color:u(i),onClick:k[0]||(k[0]=T=>l.value=!0)},{default:a(()=>[t(Z,{bottom:""},{default:a(()=>[N($(u(d)),1)]),_:1})]),_:1},8,["color"]),u(_)!==void 0?(p(),j(be,{key:0,modelValue:u(l),"onUpdate:modelValue":k[2]||(k[2]=T=>he(l)?l.value=T:null)},{default:a(()=>[t(W,null,{default:a(()=>[t(q,null,{default:a(()=>[N($(u(v)),1)]),_:1}),t(q,null,{default:a(()=>[y("p",bt,$(u(_)),1)]),_:1}),t(fe),t(Qe,null,{default:a(()=>[t(X),t(M,{color:"primary",text:"",onClick:k[1]||(k[1]=T=>l.value=!1)},{default:a(()=>k[3]||(k[3]=[N(" Close ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])):Q("",!0)],64))}}),ht=B({__name:"LoadTexts",props:{jobId:{},showMessage:{type:Boolean,default:!1}},setup(e){const r=e,{jobId:n,showMessage:d}=H(r);return(v,i)=>(p(),U(P,null,[t(me,{url:`job/${u(n)}/stdout`,tooltip:"Show Output",title:"Job output",color:"accent"},null,8,["url"]),t(me,{url:`job/${u(n)}/stderr`,tooltip:"Show Errors",title:"Job error",color:"negative"},null,8,["url"]),u(d)?(p(),j(me,{key:0,url:`job/${u(n)}/message`,tooltip:"Show Message",title:"Report message",color:"warning"},null,8,["url"])):Q("",!0)],64))}}),yt={key:6},wt={key:8},xt={key:9},kt={key:10},It={key:11},St={key:12},Ct={key:13},$t=B({__name:"JobsComponent",props:{appId:{},userId:{},fileId:{}},setup(e){const r=e,{appId:n,fileId:d,userId:v}=H(r),i=S(""),l=async()=>{if(d.value)return(await V.get(`/job/by_file/${d.value}`)).data;if(v.value)return(await V.get(`/job/by_user/${v.value}`)).data;if(n.value)return(await V.get(`/job/by_app/${n.value}`)).data},_=S([]),g=async()=>{_.value=await l()};ge(g);const k=w=>{if(w==="Done")return"bg-green-3";if(w==="Failed")return"bg-red-3";if(w==="Running")return"bg-yellow-3"},T=S(null),b={sortable:!0,align:"right"},C=[{...b,label:"ID",field:"id",name:"id"}];n.value===void 0&&C.push({...b,label:"App id",field:"app_id",name:"app_id"}),d.value===void 0&&C.push({...b,label:"File",field:"file_id",name:"file_id"}),v.value===void 0&&C.push({...b,label:"User",field:"user_id",name:"user_id"}),C.push({...b,label:"Status",field:"status",name:"status"},{...b,label:"Created",field:"created",name:"created",sortOrder:"da"},{...b,label:"Queue",field:"wait_time",name:"wait_time",sortOrder:"da"},{...b,label:"Calculation",field:"calculation_time",name:"calculation_time"},{...b,label:"Environment",field:"compute_env",name:"compute_env",sortOrder:"da"},{...b,label:"Function",field:"compute_func",name:"compute_func",sortOrder:"da"},{...b,label:"Used Memory",field:"mem_usage",name:"mem_usage"},{...b,label:"Options",field:"options",name:"options",width:"210px"}),We(()=>{T.value.sort("created")});const L=async()=>{const w=await V.get("/admin/rq_url");window.open(w.data)};return(w,o)=>(p(),j(W,{flat:""},{default:a(()=>[t(q,{class:"row"},{default:a(()=>[o[1]||(o[1]=y("div",{class:"text-h5 col"},"Jobs",-1)),t(X),t(R,{tooltip:"Refresh",icon:"mdi-refresh",color:"info",onClick:g}),t(R,{tooltip:"RQ Dashboard",icon:"mdi-rocket",color:"info",onClick:L})]),_:1}),t(q,null,{default:a(()=>[t(Ue,{dense:"",ref_key:"table",ref:T,rows:u(_),pagination:{rowsPerPage:25},"hide-bottom":u(_).length<=25,filter:u(i),columns:C,"table-header-class":""},{top:a(()=>[o[2]||(o[2]=y("div",{class:"text-h6"},"Jobs",-1)),t(X),t(oe,{borderless:"",dense:"",debounce:"300",color:"primary",modelValue:u(i),"onUpdate:modelValue":o[0]||(o[0]=m=>he(i)?i.value=m:null)},{append:a(()=>[t(pe,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell":a(({row:m,col:h})=>[t(ne,{class:Xe(k(m.status)+" text-right")},{default:a(()=>[h.name=="user_id"?(p(),j(Le,{key:0,id:m.user_id},null,8,["id"])):Q("",!0),h.name=="created"?(p(),j(de,{key:1,date:m.created},null,8,["date"])):Q("",!0),h.name=="started"?(p(),j(de,{key:2,date:m.started},null,8,["date"])):Q("",!0),h.name=="finished"?(p(),j(de,{key:3,date:m.finished},null,8,["date"])):Q("",!0),h.name=="wait_time"?(p(),j(Ce,{key:4,time:m.wait_time/1e3},null,8,["time"])):Q("",!0),h.name=="calculation_time"?(p(),j(Ce,{key:5,time:m.calculation_time/1e3},null,8,["time"])):Q("",!0),h.name=="status"?(p(),U("div",yt,$(m.status),1)):Q("",!0),h.name=="mem_usage"?(p(),j(gt,{key:7,memory:m.mem_usage},null,8,["memory"])):Q("",!0),h.name=="compute_env"?(p(),U("div",wt,$(m.compute_env),1)):Q("",!0),h.name=="compute_func"?(p(),U("div",xt,$(m.compute_func),1)):Q("",!0),h.name=="id"?(p(),U("div",kt,$(m.id),1)):Q("",!0),h.name=="file_id"?(p(),U("div",It,$(m.file_id),1)):Q("",!0),h.name=="app_id"?(p(),U("div",St,$(m.app_id),1)):Q("",!0),h.name=="options"&&!m.deleted?(p(),U("div",Ct,[t(ht,{jobId:m.id,showMessage:m.reported},null,8,["jobId","showMessage"])])):Q("",!0)]),_:2},1032,["class"])]),_:1},8,["rows","hide-bottom","filter"])]),_:1})]),_:1}))}}),Tt=B({__name:"SearchUser",props:{open:{type:Boolean}},emits:["close"],setup(e,{emit:r}){const n=S(""),d=S([]),v=S(!1),i=S(null),l=e,{open:_}=H(l),g=async()=>{if(i.value=null,n.value.length>=4){const L=(await V.post(`/app_admin/search_user/?q=${n.value}`)).data;d.value=L,v.value=!0}else d.value=[],v.value=!1},k=S(null),T=L=>{i.value=L,n.value=L.name},b=r,C=L=>{b("close",L,i.value)};return G(()=>_.value,async L=>{L&&(n.value="",d.value=[],v.value=!1)}),(L,w)=>(p(),j(be,{"model-value":u(_),"onUpdate:modelValue":w[4]||(w[4]=o=>C(!1))},{default:a(()=>[t(W,null,{default:a(()=>[t(q,null,{default:a(()=>[t(oe,{debounce:"200ms",autofocus:"",ref_key:"searchInput",ref:k,modelValue:n.value,"onUpdate:modelValue":[w[0]||(w[0]=o=>n.value=o),g],label:"Search for User",placeholder:"Enter at least 4 characters"},null,8,["modelValue"]),t(nt,{"no-focus":"",modelValue:v.value,"onUpdate:modelValue":w[1]||(w[1]=o=>v.value=o),"content-class":"menu-content",anchor:"top left",self:"bottom left"},{default:a(()=>[d.value.length>0?(p(),j(mt,{key:0,dense:"",bordered:"",separator:"",class:"menu-list"},{default:a(()=>[(p(!0),U(P,null,ve(d.value,o=>(p(),j(_e,{key:o.id,clickable:"",onClick:m=>T(o)},{default:a(()=>[t(Y,null,{default:a(()=>[t(ie,null,{default:a(()=>[N($(o.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(p(),j(_e,{key:1},{default:a(()=>[t(Y,null,{default:a(()=>[t(ie,null,{default:a(()=>w[5]||(w[5]=[N("No users found")])),_:1})]),_:1})]),_:1}))]),_:1},8,["modelValue"])]),_:1}),t(Qe,{align:"right"},{default:a(()=>[t(M,{label:"Cancel",color:"negative",onClick:w[2]||(w[2]=o=>C(!1))}),t(M,{label:"OK",disabled:i.value==null,color:"secondary",onClick:w[3]||(w[3]=o=>C(!0))},null,8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Vt=et(Tt,[["__scopeId","data-v-d414f69a"]]),Qt={class:"row"},Ut={class:"row"},Lt={class:"bg-grey-4"},Dt={style:{width:"300px"}},Ot={class:"text-h4 row"},jt={class:"row"},oa=B({__name:"AppComponent",setup(e){const r=S({}),n=S({}),d=S([]),v=S([]),i=S(!1),l=A(()=>ye.currentRoute.value.query.appId),_=()=>Math.floor(new Date().getTime()/(1e3*60*60*24)),g=async()=>{const I=(await V.post("/app_admin/app_data",{app_id:l.value})).data;d.value=I.users,r.value=I.app;const c=_();for(let x of d.value)x.unlimited=x.expiry_date==0,x.unlimited||(x.expiry_date-=c);const s=(await V.post("/app_admin/files",{app_id:l.value})).data;n.value=[...s].sort((x,z)=>z.id-x.id),v.value=(await V.post("/get_app_python_packages_metadata",{app_id:l.value})).data},k=[{value:void 0,label:"Default"},{value:re,label:K[re]},{value:xe,label:K[xe]},{value:ke,label:K[ke]},{value:Ie,label:K[Ie]},{value:Se,label:K[Se]}],T=[{label:"Username",field:"name",name:"name",sortable:!0},{label:"Access",field:"access",name:"access",sortable:!0},{label:"Expires (in days)",field:"expiry_date",name:"expiry_date",align:"right",sortable:!0},{label:"Actions",field:"actions",name:"actions"}],b=async({name:I,id:c,access_level_v:s,expiry_date:x,unlimited:z},ae=!1)=>{z?x=0:x+=_(),ae&&(s=void 0),await V.post("/app_admin/set_app_access",{app_id:l.value,user_id:c,access_level_v:s,expiry_date:x}),ue(`User ${I} ${ae?"deleted":"updated"}`),g()},C=async(I,c)=>{if(i.value=!1,!I)return;if((await V.post("/app_admin/get_app_access",{user_id:c.id,app_id:l.value})).data!=null){dt("User already has access");return}await V.post("/app_admin/set_app_access",{app_id:l.value,user_id:c.id,access_level_v:re,expiry_date:_()-1}),ue(`User ${c.name} added`),g()},L=async(I,c)=>{(c.ctrlKey||await rt("delete",`file ${I.id}`))&&(await V.file.delete(I.id),n.value=n.value.filter(s=>s.id!=I.id))},w=async()=>{at.create({title:"Delete all files",message:`Are you sure you want to delete ${Object.keys(n.value).length} files? This action cannot be undone.`,cancel:!0}).onOk(async()=>{for(const I of Object.values(n.value))await V.file.delete(I.id);n.value={}})},o=async()=>{await V.post("/app_admin/set_app_public",{app_id:l.value,public:!r.value.is_public}),r.value.is_public=!r.value.is_public},m=S(null),h=S(!1),D=S({}),J=S(null),ee=async()=>{const I=await V.get(`/model/${D.value.id}`);J.value.update(I.data)},te=async I=>{D.value=I,h.value=!0,await lt(),m.value.innerHTML="",J.value=new it(m.value,{mode:"view"}),ee()},se=async(I,c)=>{I.name!=c&&c.length!==0&&(await V.put(`/files/${I.id}`,{name:c}),I.name=c,ue(`File ${I.id} renamed to ${c}`))};return ge(g),(I,c)=>(p(),U(P,null,[t(W,{flat:""},{default:a(()=>[t(q,{class:"text-h3 row"},{default:a(()=>[N(' Manage app "'+$(u(r).name)+'" (id: '+$(u(r).id)+") ",1)]),_:1}),t(q,{class:"text-h5 row q-py-none q-my-none"},{default:a(()=>[N(" Published: "+$(u(r).is_public?"Public":"Private")+" ",1),t(M,{label:u(r).is_public?"Unpublish":"Publish",onClick:o},null,8,["label"])]),_:1}),t(q,{class:"text-h5 row"},{default:a(()=>[c[2]||(c[2]=N(" Users with special access ")),t(X),t(R,{size:"md",label:"Add User",class:"bg-secondary text-white",onClick:c[0]||(c[0]=s=>i.value=!0)})]),_:1}),t(q,{class:"row justify-center"},{default:a(()=>[t(Ue,{class:"col-auto",flat:"",rows:u(d),pagination:{rowsPerPage:10},"hide-bottom":u(d).length<=10,columns:T,"wrap-cells":""},{"body-cell-access":a(({row:s})=>[t(ne,{class:"text-center"},{default:a(()=>[t(ot,{options:k,"map-options":"","emit-value":"",modelValue:s.access_level_v,"onUpdate:modelValue":[x=>s.access_level_v=x,()=>b(s)]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),"body-cell-expiry_date":a(s=>[t(ne,{props:s},{default:a(()=>[y("div",Qt,[t(oe,{"input-class":"text-right",style:{width:"4em"},type:"number",debounce:"500",modelValue:s.row.expiry_date,"onUpdate:modelValue":[x=>s.row.expiry_date=x,()=>b(s.row)],modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"]),t(tt,{label:"never",modelValue:s.row.unlimited,"onUpdate:modelValue":[x=>s.row.unlimited=x,()=>b(s.row)]},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["props"])]),"body-cell-actions":a(s=>[t(ne,{props:s},{default:a(()=>[y("div",Ut,[t(R,{color:"negative",size:"md",icon:"delete",tooltip:"Remove access for user:"+(s.row.name?" "+s.row.name:""),onClick:x=>b(s.row,!0)},null,8,["tooltip","onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","hide-bottom"])]),_:1}),t(q,null,{default:a(()=>c[3]||(c[3]=[y("pre",null,`        Expires: days from today
        -1 = expired yesterday
        0 = expires today
        1 = expires tomorrow, etc.
      `,-1)])),_:1}),t(q,null,{default:a(()=>[t(ce,{label:"Backend packages"},{default:a(()=>[t(we,null,{default:a(()=>[c[4]||(c[4]=y("thead",null,[y("tr",null,[y("td",null,"Package"),y("td",null,"Size")])],-1)),y("tbody",null,[(p(!0),U(P,null,ve(u(v),s=>(p(),U("tr",{key:s.name},[y("td",null,$(s.name),1),y("td",null,$(Math.ceil(s.size/1024))+" kB",1)]))),128))])]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(ce,{label:"Files"},{default:a(()=>[t(we,{class:"text-center"},{default:a(()=>[y("thead",Lt,[y("tr",null,[c[5]||(c[5]=y("td",null,"Id",-1)),c[6]||(c[6]=y("td",null,"Filename",-1)),c[7]||(c[7]=y("td",null,"Owner",-1)),y("td",null,[Object.keys(u(n)).length>0?(p(),j(R,{key:0,icon:"delete",color:"negative",tooltip:"Delete all files",onClick:w})):Q("",!0)])])]),y("tbody",null,[(p(!0),U(P,null,ve(u(n),s=>(p(),U("tr",{key:s.id},[y("td",null,$(s.id),1),y("td",Dt,[t(oe,{borderless:"","model-value":s.name,"input-style":"text-align: center;",dense:"",debounce:"1000","onUpdate:modelValue":x=>se(s,x)},null,8,["model-value","onUpdate:modelValue"])]),y("td",null,[t(Le,{id:s.user_id},null,8,["id"])]),y("td",null,[t(R,{icon:"edit",tooltip:"Edit simulation",onClick:x=>u(ye).push({path:"/app",query:{id:s.id,appId:u(r).id}})},null,8,["onClick"]),t(R,{icon:"mdi-database",tooltip:"Show raw data",onClick:x=>te(s)},null,8,["onClick"]),t(R,{icon:"delete",color:"negative",tooltip:"Delete",onClick:x=>L(s,x)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(ce,{label:"Jobs"},{default:a(()=>[t($t,{appId:u(l)},null,8,["appId"])]),_:1})]),_:1})]),_:1}),t(Vt,{open:u(i),onClose:C},null,8,["open"]),t(be,{modelValue:u(h),"onUpdate:modelValue":c[1]||(c[1]=s=>he(h)?h.value=s:null)},{default:a(()=>[t(W,{class:"full-width"},{default:a(()=>[t(q,null,{default:a(()=>[y("div",Ot,[N($(u(D).name)+" ",1),t(X),u(J)?(p(),j(vt,{key:0,data:u(J).get(),filename:u(D).name,fileId:u(D).id},null,8,["data","filename","fileId"])):Q("",!0),t(M,{color:"primary",flat:"",icon:"mdi-reload",onClick:ee},{default:a(()=>[t(Z,null,{default:a(()=>c[8]||(c[8]=[N(" Reload data ")])),_:1})]),_:1})]),y("div",jt,"id: "+$(u(D).id),1)]),_:1}),t(q,{class:"full-width"},{default:a(()=>[y("div",{ref_key:"jsonEditorContainer",ref:m,class:"full-width"},null,512)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{oa as default};
