import{Q as b}from"./QSpace-BBYIxtb5.js";import{Q as L}from"./QItemLabel-Dpd1RpBi.js";import{Q as j}from"./QItemSection-gXIjE-rJ.js";import{Q as F}from"./QItem-NaHNb7v-.js";import{Q as R,_ as $}from"./ButtonWithTooltip.vue_vue_type_script_setup_true_lang-DXByFzTW.js";import{f as E,F as G,a as O,k as u,x as i,u as l,q as n,G as z,m as o,s as a,B as d,C as p,r as S,w as J,H as K,t as g,y as v,I as Y,J as W,D as X,A as I,K as w,n as N,L as Z,Q as B,M as y}from"./index-biZAYMy_.js";import{Q as k}from"./QImg-Rpy-DqvC.js";import{Q as ee}from"./QPage-iO9NnC54.js";import{api as T}from"./axios-Bf-I0BKU.js";import{V as te,T as h,S as se,u as oe,A as M}from"./apps-CncVAk-B.js";import{u as ae}from"./user-I5XOLB1z.js";import{_ as V}from"./IfAccess.vue_vue_type_script_setup_true_lang-BsVzh-wy.js";import{_ as le}from"./DateComponent.vue_vue_type_script_setup_true_lang-CxvI1VgX.js";import{c as ne}from"./utils-O6UG9Aye.js";import"./selection-DysZVcNr.js";import"./index-3fevySbJ.js";import"./auth-JCbPQ19o.js";import"./pinia-Cz-fGEgD.js";import"./marked.esm-CrmhQBcZ.js";import"./websocket-DMgNuOHa.js";import"./api-Drwuoc-q.js";import"./i18n--eaCvEqZ.js";const re=E({__name:"AccessLevelIcon",props:{accessLevel:{}},setup(A){const f=A,{accessLevel:m}=G(f),r={};r[te]={icon:"lock",color:"grey",tooltip:"No Access"},r[h]={icon:"schedule",color:"blue",tooltip:"Trial Access"},r[se]={icon:"mdi-check-circle",color:"green",tooltip:"Standard Access"};const c=O(()=>r[m.value]);return(x,q)=>l(c)?(n(),u(z,{key:0,name:l(c).icon,color:l(c).color,size:"lg"},{default:o(()=>[a(R,null,{default:o(()=>[d(p(l(c).tooltip),1)]),_:1})]),_:1},8,["name","color"])):i("",!0)}}),ie={class:"row"},ce={class:"col"},ue={class:"text-grey text-subtitle2 row no-margin no-padding"},de={key:0,class:"text-grey text-subtitle2 row no-margin no-padding"},me=["innerHTML"],pe={key:0,class:"q-pr-md"},Me=E({__name:"AppsPage",setup(A){const f=ae(),m=oe(),r=S([]),c=S({}),x=t=>{const s=new Date(0);return s.setDate(s.getDate()+t),s},q=t=>x(t)>new Date?"Expires on":"Expired on",C=t=>O(()=>(m==null?void 0:m.apps[t].access_level)>=h);J(()=>m.apps,async t=>{if(t!=null){r.value=Object.values(t),console.log("new apps",r.value);for(const s of r.value)await D(s.owner)}}),K(async()=>{await m.load(),r.value=Object.values(m.apps);for(const t of r.value)await D(t.owner)});const H=async t=>{C(t.id).value?N.push({path:"app",query:{appId:t.id}}):Q(t)},Q=async t=>{y.create({title:"Request trial access",message:`Do you want to request trial access to ${t.name}?`,cancel:!0}).onOk(async()=>{await P(t)})},P=async t=>{const e=(await T.post("/request_trial_access",{app_id:t.id})).data;e.request==="success"?y.create({message:e.message,color:"positive"}):e.request==="already_requested"?y.create({message:"You have already requested trial access to this app.",color:"warning"}):y.create({message:"Error requesting trial access.",color:"negative"})},D=async t=>{if(!t||!f.isAdmin)return"";if(c.value[t])return c.value[t];const s=await T.get(`/app_admin/user/${t}/name`);return c.value[t]=s.data,s.data},U=t=>{window.location.href=t};return(t,s)=>(n(),u(ee,null,{default:o(()=>[g("div",ie,[(n(!0),v(Y,null,W(l(r),e=>(n(),v("div",{class:"q-pa-sm col-md-4 col-sm-6 col-xs-12",key:e.name},[a(X,{class:"fit q-pa-sm hover-highlight",onClick:_=>H(e),style:{cursor:"pointer",display:"flex","flex-direction":"column"}},{default:o(()=>[a(I,{class:"text-h6 row",style:{flex:"1 1 auto"}},{default:o(()=>[g("div",ce,[d(p(e.name)+" ",1),a(V,{app:e.id,admin:""},{default:o(()=>[g("span",ue,[d(" Version: "+p(e.version)+" ",1),s[0]||(s[0]=g("br",null,null,-1)),s[1]||(s[1]=d(" Updated: ")),a(le,{date:e.last_updated},null,8,["date"]),s[2]||(s[2]=d()),s[3]||(s[3]=g("br",null,null,-1)),d(" "+p(l(c)[e.owner]?"Owner: "+l(c)[e.owner]:""),1)])]),_:2},1032,["app"]),e.owner==l(f).id&&!l(f).isAdmin?(n(),v("span",de," App Owner ")):i("",!0)]),a(b),e.access_level===l(h)?(n(),u(F,{key:0,class:"text-subtitle2"},{default:o(()=>[a(j,null,{default:o(()=>[a(L,null,{default:o(()=>[d(p(q(e.expiry_date)),1)]),_:2},1024),a(L,{caption:""},{default:o(()=>[d(p(x(e.expiry_date).toDateString()),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):i("",!0),e.access_level===l(M)?(n(),u($,{key:1,size:"xl",color:"primary",icon:"settings",class:"q-pa-none q-pb-sm",tooltip:"App management",onClick:w(_=>l(N).push({path:"/admin/app",query:{appId:e.id}}),["stop"])},null,8,["onClick"])):i("",!0),l(f).isAppDeveloper&&e.access_level==l(M)?(n(),u($,{key:2,size:"xl",icon:"mdi-dev-to",class:"q-pa-none q-pb-sm",tooltip:"Create dev command to serve this app",color:"accent",onClick:w(_=>l(ne)(e),["stop"])},null,8,["onClick"])):i("",!0),a(re,{accessLevel:e.access_level},null,8,["accessLevel"]),e.is_public?(n(),u(V,{key:3,app:e.id,admin:""},{default:o(()=>[a(z,{size:"xl",color:"positive",name:"public",class:"text-primary"},{default:o(()=>[a(R,null,{default:o(()=>s[4]||(s[4]=[d("Public")])),_:1})]),_:1})]),_:2},1032,["app"])):i("",!0)]),_:2},1024),a(I,{class:"col"},{default:o(()=>[e.image?(n(),u(k,{key:0,"no-spinner":"",src:e.image,fit:"scale-down",height:"200px",position:"0 0",style:{"max-width":"40%",float:"right",margin:"0 0 0 0px"}},null,8,["src"])):i("",!0),g("div",{innerHTML:e.text,style:{width:"100%"}},null,8,me)]),_:2},1024),a(Z,null,{default:o(()=>[e.logo.text?(n(),v("span",pe,p(e.logo.text),1)):i("",!0),e.logo.image&&e.logo.link?(n(),u(B,{key:1,flat:"",dense:"",position:"0 100%",onClick:_=>U(e.logo.link)},{default:o(()=>[a(k,{position:"left",src:e.logo.image,fit:"scale-down",height:"60px",width:"130px"},null,8,["src"])]),_:2},1032,["onClick"])):i("",!0),e.logo.image&&!e.logo.link?(n(),u(k,{key:2,position:"left",src:e.logo.image,fit:"scale-down",height:"60px",width:"130px"},null,8,["src"])):i("",!0),a(b),C(e.id).value?i("",!0):(n(),u(B,{key:3,color:"primary",onClick:w(_=>Q(e),["stop"])},{default:o(()=>s[5]||(s[5]=[d(" Request trial access ")])),_:2},1032,["onClick"]))]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]),_:1}))}});export{Me as default};
