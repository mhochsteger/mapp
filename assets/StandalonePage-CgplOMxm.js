import{Q as te}from"./QChip-CiSapyxv.js";import{g as G,r as N,a as s,X as ae,Z as H,R as ne,h as w,c as le,az as ie,aO as re,bm as oe,aC as ue,aP as se,bn as ce,aQ as W,b3 as de,aB as pe,W as fe,f as me,n as C,H as $,y as M,q as X,t as k,x as ve,u as j,s as O,bg as ge,bh as he,m as ye,C as be,I as _e,ba as K}from"./index-biZAYMy_.js";import{h as Fe}from"./format-CJebrXOQ.js";import{Q as xe,a as Se}from"./QInnerLoading-D2eT30Fi.js";import{e as Y}from"./auth-JCbPQ19o.js";import{u as Ce,_ as we}from"./RecursiveComponent.vue_vue_type_script_setup_true_lang-DnFAFAoT.js";import{u as Ae}from"./apps-CncVAk-B.js";import"./pinia-Cz-fGEgD.js";import"./QResizeObserver-YNDyCZ2F.js";import"./use-quasar-ThZkhwN7.js";import"./utils-O6UG9Aye.js";import"./api-Drwuoc-q.js";import"./axios-Bf-I0BKU.js";import"./index-3fevySbJ.js";import"./jsoneditor.min-DkeLFdXe.js";import"./marked.esm-CrmhQBcZ.js";import"./websocket-DMgNuOHa.js";function I(e,f,_,y){const r=[];return e.forEach(o=>{y(o)===!0?r.push(o):f.push({failedPropValidation:_,file:o})}),r}function T(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),H(e)}const ze={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Pe=["rejected"];function Ve({editable:e,dnd:f,getFileInput:_,addFilesToQueue:y}){const{props:r,emit:o,proxy:g}=G(),p=N(null),F=s(()=>r.accept!==void 0?r.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),S=s(()=>parseInt(r.maxFiles,10)),A=s(()=>parseInt(r.maxTotalSize,10));function z(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&ae(t);else{const h=_();h&&h!==t.target&&h.click(t)}}function P(t){e.value&&t&&y(null,t)}function u(t,h,D,R){let n=Array.from(h||t.target.files);const v=[],x=()=>{v.length!==0&&o("rejected",v)};if(r.accept!==void 0&&F.value.indexOf("*/")===-1&&(n=I(n,v,"accept",l=>F.value.some(d=>l.type.toUpperCase().startsWith(d)||l.name.toUpperCase().endsWith(d))),n.length===0))return x();if(r.maxFileSize!==void 0){const l=parseInt(r.maxFileSize,10);if(n=I(n,v,"max-file-size",d=>d.size<=l),n.length===0)return x()}if(r.multiple!==!0&&n.length!==0&&(n=[n[0]]),n.forEach(l=>{l.__key=l.webkitRelativePath+l.lastModified+l.name+l.size}),R===!0){const l=D.map(d=>d.__key);n=I(n,v,"duplicate",d=>l.includes(d.__key)===!1)}if(n.length===0)return x();if(r.maxTotalSize!==void 0){let l=R===!0?D.reduce((d,B)=>d+B.size,0):0;if(n=I(n,v,"max-total-size",d=>(l+=d.size,l<=A.value)),n.length===0)return x()}if(typeof r.filter=="function"){const l=r.filter(n);n=I(n,v,"filter",d=>l.includes(d))}if(r.maxFiles!==void 0){let l=R===!0?D.length:0;if(n=I(n,v,"max-files",()=>(l++,l<=S.value)),n.length===0)return x()}if(x(),n.length!==0)return n}function c(t){T(t),f.value!==!0&&(f.value=!0)}function i(t){H(t),(t.relatedTarget!==null||ne.is.safari!==!0?t.relatedTarget!==p.value:document.elementsFromPoint(t.clientX,t.clientY).includes(p.value)===!1)===!0&&(f.value=!1)}function q(t){T(t);const h=t.dataTransfer.files;h.length!==0&&y(null,h),f.value=!1}function V(t){if(f.value===!0)return w("div",{ref:p,class:`q-${t}__dnd absolute-full`,onDragenter:T,onDragover:T,onDragleave:i,onDrop:q})}return Object.assign(g,{pickFiles:z,addFiles:P}),{pickFiles:z,addFiles:P,onDragover:c,onDragleave:i,processFiles:u,getDndNode:V,maxFilesNumber:S,maxTotalSizeNumber:A}}const ke=le({name:"QFile",inheritAttrs:!1,props:{...oe,...re,...ze,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ie,...Pe],setup(e,{slots:f,emit:_,attrs:y}){const{proxy:r}=G(),o=ue(),g=N(null),p=N(!1),F=se(e),{pickFiles:S,onDragover:A,onDragleave:z,processFiles:P,getDndNode:u}=Ve({editable:o.editable,dnd:p,getFileInput:Q,addFilesToQueue:U}),c=ce(e),i=s(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),q=s(()=>W(i.value)),V=s(()=>i.value.map(a=>a.name).join(", ")),t=s(()=>Fe(i.value.reduce((a,m)=>a+m.size,0))),h=s(()=>({totalSize:t.value,filesNumber:i.value.length,maxFiles:e.maxFiles})),D=s(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:F.value,...y,id:o.targetUid.value,disabled:o.editable.value!==!0})),R=s(()=>"q-file q-field--auto-height"+(p.value===!0?" q-file--dnd":"")),n=s(()=>e.multiple===!0&&e.append===!0);function v(a){const m=i.value.slice();m.splice(a,1),l(m)}function x(a){const m=i.value.indexOf(a);m!==-1&&v(m)}function l(a){_("update:modelValue",e.multiple===!0?a:a[0])}function d(a){a.keyCode===13&&fe(a)}function B(a){(a.keyCode===13||a.keyCode===32)&&S(a)}function Q(){return g.value}function U(a,m){const b=P(a,m,i.value,n.value),L=Q();L!=null&&(L.value=""),b!==void 0&&((e.multiple===!0?e.modelValue&&b.every(ee=>i.value.includes(ee)):e.modelValue===b[0])||l(n.value===!0?i.value.concat(b):b))}function E(){return[w("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function Z(){if(f.file!==void 0)return i.value.length===0?E():i.value.map((m,b)=>f.file({index:b,file:m,ref:this}));if(f.selected!==void 0)return i.value.length===0?E():f.selected({files:i.value,ref:this});if(e.useChips===!0)return i.value.length===0?E():i.value.map((m,b)=>w(te,{key:"file-"+b,removable:o.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{v(b)}},()=>w("span",{class:"ellipsis",textContent:m.name})));const a=e.displayValue!==void 0?e.displayValue:V.value;return a.length!==0?[w("div",{class:e.inputClass,style:e.inputStyle,textContent:a})]:E()}function J(){const a={ref:g,...D.value,...c.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:U};return e.multiple===!0&&(a.multiple=!0),w("input",a)}return Object.assign(o,{fieldClass:R,emitValue:l,hasValue:q,inputRef:g,innerValue:i,floatingLabel:s(()=>q.value===!0||W(e.displayValue)),computedCounter:s(()=>{if(e.counterLabel!==void 0)return e.counterLabel(h.value);const a=e.maxFiles;return`${i.value.length}${a!==void 0?" / "+a:""} (${t.value})`}),getControlChild:()=>u("file"),getControl:()=>{const a={ref:o.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return o.editable.value===!0&&Object.assign(a,{onDragover:A,onDragleave:z,onKeydown:d,onKeyup:B}),w("div",a,[J()].concat(Z()))}}),Object.assign(r,{removeAtIndex:v,removeFile:x,getNativeElement:()=>g.value}),de(r,"nativeEl",()=>g.value),pe(o)}}),Ie={class:"row"},Ne={key:0,class:"q-pa-md column items-center transparent"},qe={class:"row"},De={class:"col"},Re={class:"fixed-center"},je={style:{"text-align":"center","padding-top":"130px"}},et=me({__name:"StandalonePage",setup(e){Ae(),s(()=>parseInt(C.currentRoute.value.query.backendPort)),s(()=>parseInt(C.currentRoute.value.query.websocketPort)).value&&C.replace({path:"/local",query:C.currentRoute.value.query}),s(()=>parseInt(C.currentRoute.value.query.webgpuWebsocketPort));const _=s(()=>C.currentRoute.value.query.codeUrl),y=s(()=>C.currentRoute.value.query.appId),r=async()=>{u.load();const u=u.apps;return console.log("all apps",u),u[y.value]},o=Ce(),g=N({compId:null}),p=N(!1),F=N("Loading..."),S=async u=>{p.value=!0,F.value="Loading App...";try{const V=await(await(await(await o.runAppCode(u)).component)._get_my_wrapper_props)();V&&(g.value=V),p.value=!1}catch(c){Y("Error loading app",c),p.value=!1}},A=async()=>{if(!_.value)return;const u=await fetch(_.value).then(c=>c.text());await S(u)},z=async()=>{if(!y.value)return;const u=await r();console.log("Appdata",u),p.value=!0,F.value="Loading App...";try{const c=await o.loadApp(u);c&&(g.value=c),p.value=!1}catch(c){Y("Error loading app",c),p.value=!1}},P=async u=>{const c=await u.text();await S(c)};return K("remoteApp",o),K("traceEvent",()=>{}),$(A),$(z),(u,c)=>(X(),M(_e,null,[k("div",Ie,[j(y)?ve("",!0):(X(),M("div",Ne,[O(ke,{label:"Select or drop app code file","onUpdate:modelValue":P,filled:"",style:{"max-width":"300px"}})]))]),k("div",qe,[k("div",De,[O(we,ge(he(j(g))),null,16)]),O(j(Se),{showing:j(p)},{default:ye(()=>[k("div",null,[k("div",Re,[O(xe,{size:"100px",color:"primary"})]),k("div",je,be(j(F)),1)])]),_:1},8,["showing"])])],64))}});export{et as default};
